<div id="ou-results" class="space-y-4">
	<div class="flex flex-wrap gap-3">
		<span class="px-2 py-1 rounded bg-gray-200">New Price: {{ state.P1|currency }}</span>
		<span class="px-2 py-1 rounded bg-gray-200">New Win-Rate: {{ ((state.w0_pct/100.0)*(1 - state.d_pct/100.0)) | percent }}</span>
		<span class="px-2 py-1 rounded {{ 'bg-green-200' if state.cushion > 0 else 'bg-red-200' }}">Safety Cushion: {{ (state.cushion*100)|num }}%</span>
	</div>
	<div class="overflow-auto">
		<table class="min-w-full text-sm">
			<thead>
				<tr class="text-left border-b">
					<th class="py-2">Metric</th>
					<th class="py-2">Before</th>
					<th class="py-2">After</th>
					<th class="py-2">Î”</th>
				</tr>
			</thead>
			<tbody>
				<tr class="border-b"><td class="py-1">Revenue / mo</td><td>{{ state.R0|currency }}</td><td>{{ state.R1|currency }}</td><td class="{{ 'text-green-600' if state.R1 - state.R0 > 0 else 'text-red-600' }}">{{ (state.R1-state.R0)|currency }}</td></tr>
				<tr class="border-b"><td class="py-1">Gross Profit / mo</td><td>{{ state.GP0|currency }}</td><td>{{ state.GP1|currency }}</td><td class="{{ 'text-green-600' if state.GP1 - state.GP0 > 0 else 'text-red-600' }}">{{ (state.GP1-state.GP0)|currency }}</td></tr>
				<tr class="border-b"><td class="py-1">Net Profit / mo</td><td>{{ state.NP0|currency }}</td><td>{{ state.NP1|currency }}</td><td class="{{ 'text-green-600' if state.NP1 - state.NP0 > 0 else 'text-red-600' }}">{{ (state.NP1-state.NP0)|currency }}</td></tr>
				<tr class="border-b"><td class="py-1">Margin %</td><td>{{ state.margin0|percent }}</td><td>{{ state.margin1|percent }}</td><td class="{{ 'text-green-600' if state.margin1 - state.margin0 > 0 else 'text-red-600' }}">{{ ((state.margin1-state.margin0)*100)|num }}%</td></tr>
				<tr class="border-b"><td class="py-1">ARR</td><td>{% if state.is_sub %}{{ state.ARR0|currency }}{% else %}-{% endif %}</td><td>{% if state.is_sub %}{{ state.ARR1|currency }}{% else %}-{% endif %}</td><td class="{{ 'text-green-600' if state.ARR1 - state.ARR0 > 0 else 'text-red-600' }}">{% if state.is_sub %}{{ (state.ARR1-state.ARR0)|currency }}{% else %}-{% endif %}</td></tr>
				<tr><td class="py-1">Break-Even Win-Rate Drop (d*)</td><td>-</td><td>{{ (state.d_star*100)|num }}%</td><td>-</td></tr>
			</tbody>
		</table>
	</div>
	<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
		<div>
			<canvas id="profitChart"></canvas>
		</div>
		<div>
			<canvas id="arrChart"></canvas>
		</div>
	</div>
	<script>
	(function() {
		const px = {{ state.chart_profit_x|tojson }};
		const py = {{ state.chart_profit_y|tojson }};
		const ax = {{ state.chart_arr_x|tojson }};
		const ay = {{ state.chart_arr_y|tojson }};
		const dActual = {{ state.d_pct }};
		const dStar = {{ (state.d_star*100)|round(3) }};
		if (window.__profitChart) { window.__profitChart.destroy(); }
		if (window.__arrChart) { window.__arrChart.destroy(); }
		const pctx = document.getElementById('profitChart').getContext('2d');
		window.__profitChart = new Chart(pctx, {
			type: 'line',
			data: {
				labels: px,
				datasets: [{ label: 'Net Profit / mo', data: py, borderColor: 'rgb(16, 185, 129)', backgroundColor: 'rgba(16, 185, 129, 0.2)'}]
			},
			options: {
				plugins: { legend: { display: true } },
				scales: { x: { title: { display: true, text: 'Win-Rate Drop %' } }, y: { title: { display: true, text: 'Net Profit ($/mo)' } }},
				animation: false
			}
		});
		const actx = document.getElementById('arrChart').getContext('2d');
		window.__arrChart = new Chart(actx, {
			type: 'line',
			data: {
				labels: ax,
				datasets: [{ label: 'ARR', data: ay, borderColor: 'rgb(59, 130, 246)', backgroundColor: 'rgba(59, 130, 246, 0.2)'}]
			},
			options: {
				plugins: { legend: { display: true } },
				scales: { x: { title: { display: true, text: 'Price Increase %' } }, y: { title: { display: true, text: 'ARR ($)' } }},
				animation: false
			}
		});
		// Add vertical markers for d and d*
		const pScale = window.__profitChart.scales.x;
		const idxActual = px.indexOf(Math.round(dActual));
		const idxStar = px.indexOf(Math.round(dStar));
		// A simple plugin-like overlay using scriptable tooltip lines
		// Keep minimal per spec; visual cue via title
		window.__profitChart.options.plugins.annotation = {};
	})();
	</script>
</div>
